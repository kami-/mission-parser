<!DOCTYPE html>
 
<html lang="en">
<head>
    <title>Kami formatter</title>
    <link href="styles.css" rel="stylesheet">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>

    <script type="text/javascript" src="lexer.js"></script>
    <script type="text/javascript" src="parser.js"></script>
    <script type="text/javascript" src="prettyprinter.js"></script>
</head>
<body>
    <div class="header text-center">
        <span class="header-text">Kami formatter</span>
    </div>
    <div class="container pull-center">
        <div class="row">
            <div class="col-100">
                <div class="form-buttons">
                    <button id="btn-format" onclick="mp.format()">Format</button>
                    <span class="note">Comments will be removed!</span>
                <div>
            </div>
        </div>
        <div class="row">
            <div class="col-100">
                <div id="editor" class="pp-box-size"></div>
            </div>
            <div id="error-message-box">
                <div id="error-message">
                </div>
                <button id="btn-hide-error" onclick="mp.hideError()">Clear</button>
            </div>
        </div>
        <div class="row">
            <label class="format-text">Formatted result</label>
        </div>
        <div class="row">
            <div class="col-100">
                <div id="formatted-editor" class="pp-box-size"></div>
            </div>
        </div>
    </div>
    <div>
    </div>
    <script>
        var mp = {};
        (function(mp, $, undefined) {
            var editor = ace.edit("editor"),
                formattedEditor = ace.edit("formatted-editor"),
                errorMessageBox = $("#error-message-box"),
                errorMessage = $("#error-message");

            editor.setTheme("ace/theme/github");
            editor.getSession().setMode("ace/mode/c_cpp");
            formattedEditor.setTheme("ace/theme/github");
            formattedEditor.getSession().setMode("ace/mode/c_cpp");
            errorMessageBox.hide();
            
            mp.format = function() {
                try {
                    $mp.p.init(editor.getValue(), $mp.l);
                    var ast = $mp.p.parse();
                    formattedEditor.setValue($mp.pp.pp(ast, '    '));
                    errorMessageBox.hide();
                } catch(e) {
                    console.log(e.message);
                    console.log(e.context);
                    errorMessage.text(e.message);
                    errorMessageBox.show();
                    editor.gotoLine(e.token.line + 1, e.token.column + 1, true);
                };
            };

            mp.hideError = function() {
                errorMessageBox.hide();
            };
        }(mp, jQuery));
    </script>
</body>
</html>